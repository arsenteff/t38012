;	 

	R0=%0
	R1=%1
	R2=%2
	R3=%3
	R4=%4
	R5=%5
	SP=%6
	PC=%7
	$TN=14
	$SVPC=44
	N=54
	$Z=360
	$ZZ=7734
	NOP=240
	.ASECT
;			000000-000576
	.=0
	.WORD	START,340
	.WORD	VEK4,340
	.WORD	VEK10,340
	.WORD	VEK14,340
	.WORD	SAVRON,340
	.WORD	VEK24,340
	.WORD	VEK30,340
	.WORD	VEK34,340
	.=100
	.WORD	VEK100,340
	.=170
	.WORD	VEK170,340
	.WORD	VEK174,340
	.=250
	.WORD	VEK250,340
	.=274
	.WORD	VEK274,340
	.REPT	128.
	.WORD	VEKXX,340
	.ENDR
	.=42
	.WORD	0
	.=46
	$ENDAD
	.=52
	.WORD	40000
	.=104
BUSER:	INC	@#$MAIL
	IOT
	IOT
	.=120
;	    000377
WRTMEM:	MOV	R4,R1
	MOV	@#BAKPAT,R0
	MOV	R0,(R1)+
	CMP	R1,R5
	BCS	.-4
	RTS	PC
PWRDN:	MOV	#PVRUP,@#24
	IOT	;	   
PVRUP:	MOV	@#SAVR6,SP
	MOV	#6366,R0
	ADD	SP,R0
	JSR	PC,@R0
	.ASCII	''
	.BYTE	0
	BR	START
	.=176
SWREG:	.WORD	1100
;	   
START:	MOV	@#SAVR6,SP
	MOV	#$UNIT,R3
	CLR	-(R3)
	CMP	#$MAIL,R3
	BNE	.-6
	TSTB	@#42
	BNE	RESTRT
	TSTB	@#$TESTN+1
	BMI	RESTRT
	JSR	PC,TPCRLF	;	 ""
	.ASCII	''
	.BYTE	0
	.BYTE	0
RESTRT:	MOV	#SAVR4,R3
	MOV	(R3)+,R4
	MOV	(R3)+,R5
	MOV	(R3)+,SP
	MOV	SP,R0
	MOV	#SAVMAX,-(SP)
	MOV	R0,-(SP)
	RTI
;	 
	.$X=.
	.=24
	200
	.=44
	$APTHDR
	.=.$X
$APTHD:
$HIBTS:	.WORD	0
$MBADR:	.WORD	$MAIL
$TSTM:	.WORD	12
$PASTM:	.WORD	156
$UNITM:	.WORD	0
REL=$TESTN+1
	.=$APTHD
MMAVA:
	.=MMAVA+1
TYPENB:
	.=TYPENB+1
$PRERR:
	.=$PRERR+1
$ADERR:
	.=$ADERR+1
STRTDI:
	.=STRTDI+2
LOWBNK:
	.=LOWBNK+2
PASFLG:	;	  
	.=PASFLG+2
ENDSTK:	
	.=ENDSTK+2
PBNK:
DECWRD:
	.=DECWRD+2
TYPCNT:	.BYTE	0
SAVKBB:	.BYTE	0
BAKPAT:	.WORD	377
SWAPAT:	.WORD	0
RELBOT:	BEGIN-50	;	 		
			;	 
LOWTWO:	0 		;	
LOWADD:	140000		;	
HIGHTW:	0		;	
HIGHAD:	147776		;	
$HIMAX:	0
$MAXM:	17776
MAXMEM:	.WORD	0	;	 
SAVMAX:	.WORD	0
SAVR4:	.WORD	0
SAVR5:	.WORD	0
SAVR6:	.WORD	BEGIN	;	 
			;	 
PARMAP:	0
SAVLOC:	0
PARSP:	0
PARPS:	0
;	000364-000400	
	.=400
$MAIL:	.WORD	0
$FATAL:	.WORD	0	;	 
$TESTN:	.WORD	0	;	  
$PASS:	.WORD	0	;	  
$DEVCT:	.WORD	0
$UNIT:	.WORD	0
$MSGAD:	.WORD	0
$MSGLG:	.WORD	0
$ETABL:	.BYTE	0
$ENVM:	.BYTE	0
$SWREG:	.WORD	0
$USWR:	.WORD	0
$CPUOP:	.WORD	0
$MAMS1:	.BYTE	0
$MTYP1:	.BYTE	0
$MADR1:	.WORD	0
$MAMS2:	.BYTE	0
$MTYP2:	.BYTE	0
$MADR2:	.WORD	0
$MAMS3:	.BYTE	0
$MTYP3:	.BYTE	0
$MADR3:	.WORD	0
$MAMS4:	.BYTE	0
$MTYP4:	.BYTE	0
$MADR4:	.WORD	0
;	 +20
$ETEND:	177570
	.=500
BEGIN:	MOV	PC,SP
	TST	-(SP)
	MOV	SP,@#SAVR6
	MOV	#PWRDN,@#24
	CLR	@#$PRERR
	CLR	@#TYPCNT
	MOV	#114,R0
	MOV	#5456,@R0
	ADD	PC,(R0)+
	MOV	#340,@R0
	TSTB	@#REL
	BPL	ONEPAS
	JMP	TSTREL
ONEPAS:	TST	@#$PASS
	BEQ	TSTRP
	JMP	TSTSIZ
TSTRP:	MOV	#ENDPRG,R4
	MOV	#377,R0
	MOV	R0,@#BAKPAT
	CLR	R1
	MOV	(R1)+,(R4)+
	CMP	R1,#$MAIL
	BCS	.-6
AT:	TST	-(R1)
	MOV	R0,@R1
	CMP	R0,@R1
	BEQ	.+10
	JSR	PC,FATERR	;	 1
	1
	SWAB	R0
	BNE	.-16
	TST	R1
	BNE	AT
	MOV	#$MAIL,R1
	MOV	-(R4),-(R1)
	TST	R1
	BNE	.-4
SETSWR:	MOV	#6,R0
	MOV	#340,@R0
	MOV	#714,-(R0)
	TSTB	@#$ETABL
	BEQ	.+10
	MOV	#$SWREG,@#$ETEND
	TST	@$ETEND
	BR	APTSIZ
	CMP	(SP)+,(SP)+
	MOV	#SWREG,@#$ETEND

;	   
APTSIZ:	MOV	#MAXMEM,R3
	MOV	@#HIGHTW,@#$HIMAX
	MOV	@#HIGHAD,@#$MAXM
	TSTB	@#$ENVM
	BPL	TRYSR
	MOV	#$MTYP4+4,R1
	SUB	#4,R1
	TSTB	@R1
	BNE	.+16
	CMP	R1,#$MTYP1
	BHI	.-14
	JSR	PC,FATERR	;	 2
	2
	JSR	PC,GETADR
	JSR	PC,GETADR
BRTPSZ:	BR	TYPSIZ
TRYSR:	BIT	#100,@$ETEND
	BNE	TYPSIZ
SLFSIZ:	MOV	R4,R1
	MOV	#1042,@R0
AS:	MOV	@R1,@R1
	ADD	#2,R1
	BR	.-6
	CMP	(SP)+,(SP)+
	JSR	PC,MEMMNG
	TSTB	@#MMAVA
	BEQ	CS
BS:	MOV	#1070,@R0
	MOV	#20000,R1
	BR	AS
	CMP	(SP)+,(SP)+
	CMP	#160000,R1
	BNE	.+10
	JSR	PC,UPMM
	BR	BS
CS:	CMP	-(R3),-(R1)
	JSR	PC,PUTADR
	CMP	-(R3),-(R3)
	JSR	PC,PUTADR
	TST	-(R3)
	CLR	-(R3)
	CLR	-(R3)
TYPSIZ:	MOV	#BUSER,(R0)+
	MOV	R4,R3
	MOV	#LOWTWO,R1
	JSR	PC,PCRLF
	JSR	PC,OCTTYP	;	 
TYPMEM:	JSR	PC,$TYPE	;	
	.ASCII	'-'		;	
	.BYTE	0
	JSR	PC,OCTTYP
SETSTK:	MOV	#HIGHTW,R3	
	JSR	PC,$GTSIZ
	MOV	R4,R1
	ADD	#22,R4
	DEC	R2
	BGE	.-6
	MOV	R4,@#ENDSTK
	CLR	(R1)+
	CMP	R1,R4
	BLOS	.-4
	MOV	#157776,@#MAXMEM
	TST	(R3)+
	BNE	SAVLOR
	CMP	@R3,R0
	BCC	SAVLOR
	MOV	@R3,2(R3)
SAVLOR:	JSR	PC,CLRMM
	TST	(R3)+
	MOV	@R3,R5
	CMP	R5,#17776
	BCS	ASAV
	SUB	#276,R5
	TST	@#42
	BEQ	.+16
	CMP	@#42,@#46
	BEQ	.+6
	SUB	#5674,R5
	MOV	(R5)+,(R4)+
	CMP	R5,@R3
	BLOS	.-4
ASAV:	MOV	(R3)+,(R3)+
	MOV	R4,(R3)+
TSTREL:	MOV	R5,@#SAVR5
TSTSIZ:	JSR	PC,CLRMM
	TST	-(R5)
	MOV	#LOWTWO,R3
	TST	(R3)+
	BNE	.+10
	CMP	@R3,#157776
	BCS	ATS
	BIT	#10000,@$ETEND
	BNE	.+10
	JSR	PC,FATERR	;	 3
	3
	JMP	TSTMM
ATS:	CMP	R4,(R3)+
	BCC	.+6
	MOV	-2(R3),R4
	TST	(R3)+
	BNE	.+10
	CMP	@R3,R5
	BHI	.+4
	MOV	@R3,R5
	TSTB	@#REL
	BPL	BTS
	MOV	@#RELBOT,R4
	CMP	R5,#17776
	BCS	.+6
	MOV	#17776,R5
	CMP	R4,R5
	BCS	.+10
	JSR	PC,FATERR	;	 4
	4
BTS:	MOV	#SAVMAX,R3
	MOV	@R3,-(R3)
MEMTST:	ADD	#2,@R3
	TST	(R5)+

;	  
CLRMEM:	MOV	#1,R2
	JSR	PC,PARITY
	MOV	R5,R0
	CLR	-(R0)
	CMP	R0,R4
	BHI	.-4
	MOV	#BAKPAT,R2
	MOV	(R2)+,@R2
	SWAB	@R2
	MOV	@$ETEND,R2
	BIC	#177760,R2
CONT:	CLR	@#PASFLG
	MOVB	R2,@#$TESTN
LOOP:	MOV	R4,R1
	MOV	R2,-(SP)
	MOV	#376,R3
	JSR	PC,PUTADR
	TST	-(R3)
	JSR	PC,$GTSIZ
	MOV	R4,R0
	MOV	R4,R1
	MOV	R4,R3
	MOV	(SP)+,R2
	ASL	R2
	ADD	PC,R2
	ADD	4(R2),PC

;	  
TBL:	TST0-TBL
	TST1-TBL
	TST2-TBL
	TST3-TBL
	TST4-TBL
	TST5-TBL
	TST6-TBL
	TST7-TBL
	TST10-TBL
	TST11-TBL
	TST12-TBL
	TST13-TBL
	RELOC-TBL

;	  
TSTSCP:	TSTB	@#$ETABL
	BNE	CNTSCP
	JSR	PC,CHECKC
CNTSCP:	MOVB	@#$TESTN,R2
	INC	@#$DEVCT
	BIT	#2000,@$ETEND
	BEQ	TSTGO
SWHALT:	IOT	;	 
TSTGO:	BIT	#40000,@$ETEND
	BNE	LOOP
	INCB	R2
	BR	CONT

;	 0.	  

TST0:	TSTB	@#$TESTN
	BEQ	.+10
	JSR	PC,FATERR	;	 5
	5
	MOV	#-1,R3
TST0A:	MOV	R4,R1
	MOV	R3,@R0
TST0B:	CMP	R0,R1
	BEQ	TST0C
	TST	@R1
	BEQ	TST0D
  	CMP	R3,@R1
	BNE	.+12
	MOV	#6,2012	;	 6
	BR	.+10
	MOV	#7,2012	;	 7
	MOV	R0,-(SP)
	INCB	@#$ADERR
	BR	.+20
TST0C:	CMP	R3,@R1
	BEQ	TST0D
	MOV	#10,2012 ;	 10
	MOV	R0,-(SP)
	MOV	R3,R0
	JSR	PC,ERROR
	.WORD	0
	MOV	(SP)+,R0
TST0D:	MOV	@#SAVR6,SP
	ADD	#20000,R1
  	CMP	R1,R5
	BCS	TST0B
	TSTB	@#$ENVM
	BMI	TST0E
	BIT	#100,@$ETEND
	BNE	TST0E
  	CMP	R1,@#MAXMEM
	BCS	TST0D
	MOV	#6,R2
	MOV	#340,@R2
	MOV	#177722,-(R2)
	ADD	PC,@R2
  	CMP	R1,#157776
	BHI	.+12
	MOV	@R1,@R1
	JSR	PC,FATERR	;	 11
	11
	MOV	#6,(R2)+
	CLR	@R2
TST0E:	CLR	@R0
	ADD	#20000,R0
	CMP	R0,R5
	BCS	TST0A
END0:	BR	TSTSCP

;	 1.	    

TST1:	CMPB	#1,@#$TESTN
	BEQ	.+10
	JSR	PC,FATERR	;	 12
	12
TST1A:	MOV	#1,R0
	MOV	R0,R2
TST1B:	MOV	R0,@R1
	CMP	R0,@R1
	BEQ	.+10
	JSR	PC,ERROR
	13
	TST	R2
	BEQ	.+16
	ASL	R0
	BCC	TST1B
	CLR	R2
	MOV	#177776,R0
	BR	TST1B
	SEC
	ROL	R0
	BCS	TST1B
	ADD	#20000,R1
  	CMP	R1,R5
	BCS	TST1A
END1:	BR	END0

;	 2.	     

TST2:	CMPB	#2,@#$TESTN
	BEQ	.+10
	JSR	PC,FATERR	;	 14
	14
TST2A:	MOV	@#BAKPAT,R0
	MOVB	R0,(R1)+
	MOVB	@#BAKPAT+1,(R1)+
	CMP	R1,R5
	BCS	.-14
TST2B:	CMP	R0,-(R1)
	BEQ	TST2C
	ADD	#2,R1
	CMPB	@#BAKPAT+1,-(R1)
	BEQ	.+6
	CMPB	R0,-(R1)
	BNE	.+6
	INCB	@#$ADERR
	BIC	#1,R1
	JSR	PC,ERROR	;	 15
	15
TST2C:	CMP	R1,R4
	BHI	TST2B
	SWAB	@#BAKPAT
	BEQ	TST2A
END2:	BR	END1

;	 3.	  

TST3:	CMPB	#3,@#$TESTN
	BEQ	.+10
	JSR	PC,FATERR	;	 16
	16
	CLR	R3
	JSR	PC,@#WRTMEM
TST3A:	CLR	R2
TST3B:	BIS	R3,R2
	CMP	R2,R4
	BCS	TST3H
  	CMP	R2,R5
	BCC	TST3I
	SWAB	@R2
	CLR	R1
TST3C:	BIS	R3,R1
	CMP	R1,R4
	BCS	TST3F
	CMP	R1,R5
	BCC	TST3G
	CMP	R1,R2
	BEQ	TST3E
	CMP	R0,@R1
	BEQ	TST3F
	MOV	#17,2472	;	 17
TST3D:	MOV	R0,-(SP)
	SWAB	@SP
	CMP	(SP)+,@R1
	BNE	.+10
	MOV	#20,2472	;	 20
	INCB	@#$ADERR
	MOV	R0,-(SP)
	MOV	R2,R0
	JSR	PC,ERROR
	.WORD	0
	MOV	(SP)+,R0
	MOV	R0,@R1
	CMP	R0,@#BAKPAT
	BEQ	TST3F
	BR	.+20
TST3E:	SWAB	R0
	CMP	R0,@R1
	BEQ	.+12
	MOV	#21,2472	;	 21
	BR	TST3D
	SWAB	R0
TST3F:	BIC	R3,R1
	TST	R1
	BNE	.+4
	INC	R1
	ROL	R1
	CMP	R1,#20000
	BCS	TST3C
TST3G:	SWAB	@R2
TST3H:	BIC	R3,R2
	TST	R2
	BNE	.+4
	INC	R2
	ROL	R2
	CMP	R2,#20000
	BCS	TST3B
	ADD	R2,R3
  	CMP	R3,@#MAXMEM
	BCS	TST3A
TST3I:	SWAB	@#BAKPAT
	BEQ	TST3
END3:	BR	END2

;	 4.	  B

TST4:	CMPB	#4,@#$TESTN
	BEQ	.+10
	JSR	PC,FATERR	;	 22
	22
	CLR	R3
TST4A:	MOV	R1,R0
	TST	R3
	BEQ	.+4
	COM	R0
	MOV	R0,(R1)+
	CMP	R1,R5
	BCS	.-14
TST4B:	CMP	R0,-(R1)
	BEQ	.+14
	INCB	@#$ADERR
	JSR	PC,ERROR	;	 23
	23
	MOV	R1,R0
	SUB	#2,R0
	TST	R3
	BEQ	.+4
	COM	R0
	CMP	R1,R4
	BHI	TST4B
	MOVB	#1,@#PASFLG
	COM	R3
	BNE	TST4A
END4:	BR	END3

;	 5.	   

TST5:	CMPB	#5,@#$TESTN
	BEQ	.+10
	JSR	PC,FATERR	;	 24
	24
	JSR	PC,@#WRTMEM
TST5A:	CMP	R0,-(R1)
	BEQ	.+10
	JSR	PC,ERROR	;	 25
	25
TST5B:	SWAB	R0
	MOV	R0,@R1
	CMP	@R1,R0
	BEQ	.+10
	JSR	PC,ERROR	;	 26
	26
	SWAB	R0
	BNE	TST5E
TST5C:	TST	R3
	BNE	TST5F
	ADD	#2,R1
	CMP	R1,R5
	BCC	.+16
TST5D:	CMP	R0,@R1
	BEQ	TST5B
	JSR	PC,ERROR	;	 27
	27
	BR	TST5B
	INCB	@#PASFLG
	SWAB	R0
	BEQ	TST5A
	COM	R3
	MOV	R4,R1
	BR	TST5D
TST5E:	TST	R3
	BNE	TST5C
TST5F:	CMP	R1,R4
	BHI	TST5A
	INCB	@#PASFLG
	SWAB	R0
	BEQ	TST5D
END5:	BR	END4

;	 6.	  

TST6:	CMPB	#6,@#$TESTN
	BEQ	RPT6
	JSR	PC,FATERR	;	 30
	30
RPT6:	JSR	PC,@#WRTMEM
	CLR	@#PASFLG
	MOV	R4,R3
TST6A:	MOV	R4,R1
	CMP	R0,@R1
	BEQ	.+10
	JSR	PC,ERROR	;	 31
	31
	ADD	#2,R1
	CMP	R1,R5
	BCS	.-20
	BITB	#1,@#PASFLG
	BNE	.+6
	INCB	@#PASFLG
	CMP	R3,R5
	BCC	TST6B
	MOV	#37776,R2
	SWAB	@R3
	DEC	R2
	BNE	.-4
	MOV	R3,@#SAVLOC
	ADD	#20000,R3
	BR	TST6A
TST6B:	INCB	@#PASFLG
	SWAB	@#BAKPAT
	BEQ	RPT6
END6:	BR	END5

;	 7.	    

TST7:	CMPB	#7,@#$TESTN
	BEQ	.+10
	JSR	PC,FATERR	;	 32
	32
TST7A:	CLR	@#PASFLG
	MOV	R3,@#LOWBNK
	MOV	R3,R2
	BIS	#17776,R2
	TST	(R2)+
	CMP	R5,R2
	BCC	.+4
	MOV	R5,R2
TST7B:	MOV	R3,@#$TSTM
	MOV	@#LOWBNK,R1
TST7C:	MOV	@#BAKPAT,R0
	CMP	R1,R3
	BNE	TST7D
	ADD	#2,R3
	BIT	#176,R3
	BEQ	.+6
	ADD	#200,R3
	SWAB	R0
	BITB	#1,@#PASFLG
	BNE	.+4
	MOV	R0,@R1
	CMP	R0,@R1
	BEQ	.+10
	JSR	PC,ERROR	;	 33
	33
	ADD	#2,R1
	CMP	R1,R2
	BCS	TST7C
	INC	@#$DEVCT
	INCB	@#PASFLG
	MOV	@#$TSTM,R3
TST7D:	BITB	#1,@#PASFLG
	BNE	TST7B
	TST	(R3)+
	CMP	R3,R2
	BCC	.+10
	TSTB	@#PASFLG
	BPL	TST7B
	MOV	@#LOWBNK,R3
	SWAB	@#BAKPAT
	BEQ	TST7B
	MOV	R2,R3
	CMP	R2,R5
	BCS	TST7A
END7:	BR	END6

;	 10.	 

TST10:	CMPB	#10,@#$TESTN
	BEQ	.+10
	JSR	PC,FATERR	;	 34
	34
	MOV	R4,R2
RPT10:	BIS	#17776,R2
GALLOP:	ADD	#2,R2
	CMP	R2,R5
	BLOS	.+4
	MOV	R5,R2
TST10A:	CLR	-(SP)
	MOV	R2,R0
	MOV	@#BAKPAT,-(R0)
	CMP	R0,R3
	BHI	.-6
TST10B:	MOV	R3,R1
	CMP	@#BAKPAT,@R0
	BEQ	TST10C
	MOV	R0,R1
	MOV	@#BAKPAT,R0
	JSR	PC,ERROR	;	 35
	35
	MOV	R0,@R1
	MOV	R1,R0
TST10C:	SWAB	@R0
TST10D:	BIT	@R0,@R1
	CMP	R0,R1
	BEQ	TST10E
	CMP	@R1,@#BAKPAT
	BEQ	.+20
	MOV	R0,-(SP)
	MOV	@#BAKPAT,R0
	JSR	PC,ERROR	;	 36
	36
	MOV	(SP)+,R0
TST10E:	CMP	@R0,@#SWAPAT
	BEQ	TST10F
	MOV	R1,-(SP)
	MOV	R0,R1
	MOV	@#SWAPAT,R0
	JSR	PC,ERROR	;	 37
	37
	MOV	R0,@R1
	MOV	R1,R0
	MOV	(SP)+,R1
TST10F:	CMPB	#11,@#$TESTN
	BEQ	.+6
	ADD	#176,R1
	ADD	#2,R1
	CMP	R1,R2
	BCS	TST10D
	SWAB	(R0)+
	CMPB	#11,@#$TESTN
	BEQ	.+20
	TST	(R3)+
	ADD	#2,@SP
	TSTB	@SP
	BPL	.+6
	SUB	@SP,R3
	CLR	@SP
	BIT	#177,R0
	BNE	.+6
	INC	@#$DEVCT
	CMP	R0,R2
	BCS	TST10B
	SUB	(SP)+,R3
	SWAB	@#SWAPAT
	SWAB	@#BAKPAT
	BEQ	TST10A
	MOV	R2,R3
	CMP	R2,R5
	BEQ	END10
	BIT	#17776,R2
	BNE	RPT11
	CMPB	#11,@#$TESTN
	BEQ	RPT11
	BR	RPT10
END10:	BR	END7

;	 11.	  

TST11:	CMPB	#11,@#$TESTN
	BEQ	.+10
	JSR	PC,FATERR	;	 40
	40
	MOV	R4,R2
	TSTB	@$ETEND
	BPL	RPT11
	JSR	PC,PNTMES	;	
	.ASCII	''		;	""
	.BYTE	0
RPT11:	TSTB	@$ETEND
	BMI	RPT10
	BIS	#176,R2
	BR	GALLOP

;	 12.	  

TST12:	CMPB	#12,@#$TESTN
	BEQ	.+10
	JSR	PC,FATERR	;	 41
	41
	MOV	#2,R2
	MOV	#400,R3
TST12A:	MOVB	#1,@#PASFLG
TST12B:	MOV	R4,R1
TST12C:	MOV	@#BAKPAT,R0
	BIT	R2,R1
	BNE	.+12
	BIT	R3,R1
	BEQ	.+12
	COM	R0
	BR	.+6
	BIT	R3,R1
	BEQ	.-6
	BITB	#2,@#PASFLG
	BNE	.+4
	MOV	R0,@R1
	CMP	R0,@R1
	BEQ	.+10
	JSR	PC,ERROR	;	 42
	42
	MOV	#2,-(SP)
TST12D:	COM	R0
	COM	@R1
	CMP	R0,@R1
	BEQ	.+12
	JSR	PC,ERROR	;	 43
	43
	MOV	R0,@R1
	DEC	@SP
	BNE	TST12D
	TST	(SP)+
	CMPB	#3,@#PASFLG
	BEQ	TST12E
	ADD	#2,R1
	CMP	R1,R5
	BCS	TST12C
	INCB	@#PASFLG
	CMPB	#2,@#PASFLG
	BEQ	TST12B
TST12E:	SUB	#2,R1
	CMP	R1,R4
	BCC	TST12C
	MOV	#20000,R2
	INCB	@#PASFLG+1
	CMPB	@#PASFLG+1,#2
	BCS	TST12A
	BHI	.+12
	MOV	#10,R2
	ASL	R3
	BR	TST12A
	COM	@#BAKPAT
	TSTB	@#BAKPAT
	BEQ	TST12
END12:	BR	END10

;	 13.	 

TST13:	CMPB	#13,@#$TESTN
	BEQ	.+10
	JSR	PC,FATERR	;	 44
	44
	MOV	#10247,R2
	MOV	#177667,R0
TST13A:	MOV	R5,-(SP)
	MOV	R4,-(SP)
	CLC
	ROR	R5
	ROR	R4
	SUB	R4,R5
	ROR	R5
	BCC	.+6
	ADD	#2,@SP
	MOV	(SP)+,R4
	MOV	(SP)+,R5
	MOV	R4,R3
	BR	.+14
TST13B:	BIC	#17776,R3
	TSTB	@#REL
	BMI	TST13F
	CMP	R3,R5
	BCC	TST13F
	CMP	R5,#20000
	BCC	.+6
	MOV	R5,R1
	BR	.+14
	MOV	R3,R1
	BIC	#17776,R1
	ADD	#20000,R1
	CMP	R1,@#MAXMEM
	BHI	TST13F
	BITB	#1,@#PASFLG
	BNE	TST13H
TST13C:	CMP	R3,R4
	BCS	TST13D
	TSTB	@#PASFLG+1
	BNE	.+6
	MOV	#10247,@R3
	CMP	R2,@R3
	BEQ	TST13D
	MOV	R0,-(SP)
	MOV	R1,-(SP)
	MOV	R3,R1
	MOV	R2,R0
	JSR	PC,ERROR	;	 45
	45
	MOV	(SP)+,R1
	MOV	(SP)+,R0
	TSTB	@#PASFLG
	BNE	.+14
	MOV	R2,R0
	JSR	PC,ERROR	;	 46
	46
	BR	END12	;	 
TST13D:	ADD	#2,R3
	SUB	#2,R1
	CMP	R1,R5
	BCC	TST13E
	CMP	R1,R3
	BCS	.+14
	TSTB	@#PASFLG+1
	BNE	.+6
	MOV	#177667,@R1
	CMP	R0,@R1
	BEQ	.+10
	JSR	PC,ERROR	;	 47
	47
TST13E:	CMP	R3,R1
	BCS	TST13C
	ADD	#20000,R3
	BR	TST13B
TST13F:	CMPB	#1,@#PASFLG
	BEQ	TST13J
	BCS	END12
	COMB	@#PASFLG+1
	BNE	TST13A
	MOV	#5141,R2
	MOV	#177740,R0
	ADD	PC,R0
TST13G:	INCB	@#PASFLG
	BR	TST13A
TST13H:	BIT	#20,@$ETEND
	BNE	TST13I
	TSTB	@#42
	BNE	TST13I
	JSR	PC,PNTMES	;	
	.ASCII	'13 '	;	"13 "
	.BYTE	0
	.EVEN
	JSR	PC,GETBNK
	JSR	PC,$TPDEC
TST13I:	JMP	@R3
TST13J:	COMB	@#PASFLG+1
	MOV	#110,R0
	BR	TST13G
	.EOT

;	  
RELOC:	MOV	#377,@#BAKPAT
	TSTB	@#MMAVA
	BNE	CONTMM
	BIT	#1000,@$ETEND
	BNE	CKDONE
	TSTB	@#REL
	BMI	RELOER
	MOVB	#200,@#REL

;	   
	JSR	PC,PNTMES	;	
	.ASCII	''		;	""
	.BYTE	0
	MOV	@#MAXMEM,R5
	MOV	-(R4),-(R5)
	CMP	R4,#$MAMS1
	BHI	.-6
	JMP	50(R5)

;	    00
RELOER:	MOV	@#SAVR5,R5
	TSTB	@#REL
	BPL	CKDONE
	MOV	#$MAMS1,R4
	MOV	(R5)+,(R4)+
	CMP	R5,@#MAXMEM
	BCS	.-6
	CLRB	@#REL
	MOV	R5,@#SAVR5
	MOV	#BEGIN,SP
	MOV	SP,@#SAVR6
CKDONE:	JMP	@#LOWER
LOWER:	TSTB	@#$FATAL
	BEQ	.+6
	JMP	APTHLT
	TSTB	@#SAVKBB
	BNE	$TPSTK
TSTMM:	JSR	PC,MEMMNG
	TSTB	@#MMAVA
	BEQ	ENDPAS
	BR	$CNTMM
CONTMM:	JSR	PC,UPMM
$CNTMM:	MOV	#LOWTWO,R3
	JSR	PC,GETSIZ
	MOV	#20000,R4
	CMP	R2,@#172342	
	BCS	.+14
	BIS	R1,R4
	SUB	#200,R2
	JSR	PC,MMREG
	JSR	PC,GETSIZ
	JSR	PC,MAXADR
	MOV	R0,R5
	JSR	PC,GETSIZ
	JSR	PC,MAXADR
	MOV	R0,@R3
	JMP	CLRMEM
MAXADR:	MOV	R0,-(SP)
	MOV	#172356,R0
	SUB	#20000,@SP
	BIS	R1,@SP
	CMP	R2,-(R0)
	BEQ	.+22
	CMP	R0,#172340
	BHI	.-16
	TST	(R0)+
	CMP	@R0,R2
	BGT	.+16
	MOV	#157776,@SP
	MOV	(SP)+,R0
	ADD	#2,R0
	RTS	PC
	CMP	(SP)+,(SP)+
	
;	  
ENDPAS:	BIT	#20,@$ETEND
	BNE	$EOP
$TPSTK:	MOV	#-1,-(SP)
	MOV	#ENDPRG,R1
TYPSTK:	MOV	#376,R3
	INC	@SP
	CMP	R1,@#ENDSTK
	BCC	$EOP
	MOVB	#22,R2
RETSTK:	DECB	R2
	BLT	TYPSTK
	TSTB	(R1)+
	BEQ	RETSTK
	CMP	R2,#20
	BCS	.+12
	BHI	PARFL
	JSR	PC,TRADER
	BR	FAILNM
	MOV	R2,@#PBNK
	JSR	PC,TYPDEC
FAILNM:	MOV	@SP,@#PBNK
	JSR	PC,$TPDEC
	CLR	-(R3)
	MOVB	-(R1),@R3
	CLRB	(R1)+
	CLR	-(R3)
	INCB	@#TYPCNT
	JSR	PC,RPTOCT
	BR	RETSTK
PARFL:	JSR	PC,TPPRER
	BR	FAILNM

;	 "  #"
$EOP:	CLR	R2
	JSR	PC,PARITY
	TSTB	@#SAVKBB
	BNE	CTLC
	INC	@#$PASS
	BIT	#40,@$ETEND
	BNE	ACT11
TYPEOP:	JSR	PC,TPCRLF
	.ASCII	'  #'
	.BYTE	0
	.EVEN
	MOV	@#$PASS,@#PBNK
	JSR	PC,$TPDEC
ACT11:	MOV	@#42,R0
	BEQ	$DOAGN
	RESET
$ENDAD:	JSR	PC,@R0
	NOP
	NOP
	NOP
$DOAGN:	JMP	@#RESTRT
CTLC:	JSR	PC,CLRMM
	MOV	@#SAVR4,R4
	MOV	-(R4),-(R5)
	CMP	R4,@#ENDSTK
	BHI	.-6
	JMP	APTHLT

;		  
ERROR:	MOV	@0(SP),@#$FATAL
	MOV	R3,-(SP)
	MOV	R0,-(SP)
	MOV	R1,R3
	JSR	PC,GETBNK
	MOV	@#PBNK,R3
	MOVB	R3,@#403
	MOV	R3,-(SP)
	MOV	#376,R3
	MOV	@#PASFLG,-(R3)
	CLR	-(R3)
	MOVB	@#$FATAL,@R3
	MOV	6(SP),-(R3)
	MOV	@R1,-(R3)
	MOV	R0,-(R3)
	CLR	-(R3)
	MOV	4(R3),@R3
	BIC	R0,@R3
	BIC	4(R3),R0
	BIS	R0,@R3
	MOV	#2016,R0
	ADD	PC,R0
	ADD	#22,R0
	DEC	@SP
	BGE	.-6
	TST	(SP)+
ERRTYP:	CLRB	@#TYPENB
	TSTB	@#$PRERR
	BNE	.+20
	TSTB	(R0)+
	TSTB	@#$ADERR
	BNE	.+10
	TSTB	(R0)+
	TST	@R3
	BPL	.+34
	CMPB	#377,@R0
	BEQ	.+4
	INCB	@R0
	CMPB	#1,@R0
	BEQ	.+12
	BIT	#400,@$ETEND
	BNE	.+6
	INCB	@#TYPENB
	TSTB	@#$PRERR
	BEQ	.+10
	JSR	PC,TPPRER
	BR	.+24
	TSTB	@#$ADERR
	BEQ	.+10
	JSR	PC,TRADER
	BR	.+10
	TSTB	(R0)+
	ASL	@R3
	BNE	.-72
	MOVB	#6,@#TYPCNT
	JSR	PC,PUTADR
	JSR	PC,TYPERR
	CLR	@#$PRERR
	MOV	(SP)+,R0
	MOV	(SP)+,R3
FNDERR:	TSTB	@#$ETABL
	BEQ	.+12
	MOV	#1,@#$MAIL
	BR	FATHLT
	MOV	R2,-(SP)
	TST	@$ETEND
	BMI	.+14
	JSR	PC,CHECKC
	TSTB	@#42
	BEQ	.+4
	IOT		;	   (15=1)
	MOV	(SP)+,R2
	ADD	#2,@SP
	RTS	PC
FATERR:	JSR	PC,TPCRLF	;	
	.ASCII	' #'	;	" #"
	.BYTE	0
	.BYTE	0
	MOV	@0(SP),@#$FATAL
	INCB	@#TYPCNT
	MOV	#376,R3
	MOV	@#$FATAL,-(R3)
	TST	-(R3)
	JSR	PC,FATYP
APTHLT:	TSTB	@#$ETABL
	BNE	FNDERR
FATHLT:	IOT			;	   
	JMP	@#RESTRT
PARERR:	MOV	(SP)+,@#PARSP
	MOV	@SP,@#PARPS
	MOV	@#SAVR6,SP
	MOV	R0,SAVR0
	MOV	R1,SAVR1
	MOV	@#PARMAP,R1
	MOV	#172100,R0
	TST	R1
	BEQ	.+106
	CLC
	ROR	R1
	BCC	.+14
	TST	@R0
	BMI	.+16
	CMP	R0,#172136
	BGE	.+66
	ADD	#2,R0
	BR	.-22
	BIC	#100000,@R0
	MOV	@R0,R1
	ROL	R1
	ROL	R1
	ROL	R1
	ROL	R1
	BIC	#777,R1
	INCB	@#$PRERR
	JSR	PC,ERROR
	50
	MOV	SAVR0,R0
	MOV	SAVR1,R1
	MOV	@#PARPS,-(SP)
	MOV	@#PARSP,-(SP)
	RTI
	JSR	PC,FATERR
	51
SAVR0:	0
SAVR1:	0
TRADER:	TSTB	@#TYPENB
	BEQ	.+16
	JSR	PC,PNTMES	;	
	.ASCII	' '	;	" "
	.BYTE	0
	.BYTE	0
	RTS	PC
TPPRER:	TSTB	@#TYPENB
	BEQ	.+16
	JSR	PC,PNTMES
	.ASCII	' '	;	" "
	.BYTE	0
	.BYTE	0
	RTS	PC

;		
NOTYP:	MOV	R1,-(SP)
	MOV	2(SP),R1
	TSTB	(R1)+
	BNE	.-2
	BR	RETTYP
$TYPE:	MOV	R1,-(SP)
	MOV	R0,-(SP)
	MOV	4(SP),R1
	MOVB	(R1)+,R0
	JSR	PC,$TPCHR
	TSTB	R0
	BNE	.-10
	MOV	(SP)+,R0
RETTYP:	INC	R1
	BIC	#1,R1
	MOV	R1,2(SP)
	MOV	(SP)+,R1
	BR	EXTYP
$TPCHR:	NOP	;BITB	#40,@#$ENVM
	NOP	;BNE	.+14
	NOP	;TSTB	@#$TPS
	NOP	;BPL	.-4
	NOP
	NOP
	NOP
	JMP	7514
	BR	EXTYP
PCRLF:	JSR	PC,$TYPE
	.BYTE	15,12
	.BYTE	0
	.EVEN
EXTYP:	RTS	PC
TPCRLF:	JSR	PC,PCRLF
	BR	$TYPE
PNTMES:	BIT	#20,@$ETEND
	BNE	NOTYP
	CMPB	@#42,@#46
	BEQ	NOTYP
	BR	TPCRLF

;		 
TYPDEC:	JSR	PC,PCRLF
$TPDEC:	CLR	-(SP)
	MOV	@#PBNK,-(SP)
	SUB	#12,@SP
	BLT	.+10
	INC	2(SP)
	BR	.-12
	ADD	#12,@SP
	BIS	#60,@SP
	MOVB	(SP)+,6672
	BIS	#60,@SP
	MOVB	(SP)+,6671
	JSR	PC,$TYPE
	.ASCII	'   00'
	.BYTE	0
	RTS	PC

;		 
TYPERR:	BIT	#20000,@$ETEND
	BNE	OCTXT
	JSR	PC,PCRLF
	JSR	PC,TYPOCT
	BR	OCTXT
OCTTYP:	MOV	(R1)+,(R3)+
	MOV	(R1)+,@R3
	INCB	@#TYPCNT
TYPOCT:	BIS	#4,-(R3)
	ROLB	@R3
	BCC	.-2
	CLR	R0
	ROLB	@R3
	ROL	R0
	ROLB	@R3
	ROL	R0
	BR	$TPNUM
RPTOCT:	JSR	PC,$TYPE
	.ASCII	'   '	
	.BYTE	0
FATYP:	CLR	R0
$TPNUM:	MOV	#6,(R3)+
	CLC
	ROL	@R3
	ROL	R0
	BIS	#60,R0
	JSR	PC,$TPCHR
	CLR	R0
	ROL	@R3
	ROL	R0
	ROL	@R3
	ROL	R0
	DECB	177776(R3)
	BNE	.-34
	DECB	@#TYPCNT
	BNE	RPTOCT
OCTXT:	RTS	PC

;	  
MEMMNG:	MOV	#1400,R2
MMREG:	CLRB	@#MMAVA
	BIT	#10000,@$ETEND
	BEQ	RETMM
	MOV	#4,R0
	MOV	#NOMM,(R0)+
	MOV	#340,@R0
	NOP	
	NOP
	INCB	@#MMAVA
	MOV	#172340,R1
	CLR	(R1)+
	ADD	#200,R2
	MOV	R2,(R1)+
	CMP	R1,#172356
	BCS	.-12
	MOV	#7600,@R1
	MOV	#172300,R1
	MOV	#77406,(R1)+
	CMP	R1,#172316
	BLOS	.-10
	NOP	
	NOP
$RETMM:	CLR	@R0
	MOV	#BUSER,-(R0)
RETMM:	RTS	PC
NOMM:	CMP	(SP)+,(SP)+
	JSR	PC,TPCRLF	;	
	.ASCII	' '	;	" "	
	.BYTE	0
	.EVEN 
	JSR	PC,FATERR
	52
	BR	$RETMM
UPMM:	MOV	@#172354,R2
	BR	MMREG

;		18-  
PUTADR:	CLR	-2(R3)
	MOV	R1,@R3
	TSTB	@#MMAVA
	BEQ	.+54
	MOV	R1,-(SP)
	BIC	#17777,R1
	BIC	R1,@R3
	BIS	#4000,R1
	ROR	R1
	BCC	.-2
	ADD	#172340,R1
	MOV	@R1,R1
	BIS	#10000,R1
	ROL	R1
	BCC	.-2
	ROL	R1
	ROL	-(R3)
	ROL	R1
	ROL	(R3)+
	BIS	R1,@R3
	MOV	(SP)+,R1
	RTS	PC
GETADR:	MOV	1(R1),-(R3)
	CLR	-(R3)
	MOVB	-1(R1),@R3
	RTS	PC
$GTSIZ:	INCB	@#SAVKBB
GETSIZ:	MOV	(R3)+,R1
	MOV	@R3,R2
	BIC	#17777,R2
	BIS	#40,R2
	ROR	R1
	ROR	R2
	BCC	.-4
	TSTB	@#SAVKBB
	BEQ	.+14
	CLRB	@#SAVKBB
	BIS	#100,R2
	BR	.-24
	MOV	(R3)+,R1
	MOV	#160000,R0
	BIC	R0,R1
	RTS	PC
	 
;	  
CLRMM:	TSTB	@#MMAVA
	BEQ	.+12
	NOP
	NOP
	CLRB	@#MMAVA
	RTS	PC
GETBNK:	MOV	R0,-(SP)
	MOV	R3,-(SP)
	BIC	#17777,R3
	BIS	#10000,R3
	CLC
	ROR	R3
	BCC	.-2
	TSTB	@#MMAVA
	BEQ	.+20
	ASL	R3
	ADD	#172340,R3
	MOV	@R3,R0
	ASL	R0
	SWAB	R0
	MOVB	R0,R3
	MOV	R3,@#PBNK
	MOV	(SP)+,R3
	MOV	(SP)+,R0
	RTS	PC
PARITY:	BIT	#4000,@$ETEND
	BR	.+142
	MOV	#4,R0
	MOV	#122,@R0
	ADD	PC,@R0
	CLR	@#PARMAP
	MOV	#172140,R1
	MOV	#100000,R3
	MOV	R2,-(R1)
	BIS	R3,@#PARMAP
	CLC
	ROR	R3
	BCC	.-12
	MOV	#BUSER,@R0
	TST	R2
	BEQ	.+70
	TST	@#PARMAP
	BNE	.+24
	JSR	PC,TPCRLF
	.ASCII	' '
	.BYTE	0
	.EVEN 
	JSR	PC,FATERR
	53
	BISB	#40,@#REL
	MOV	#376,@#BAKPAT
	JSR	PC,TPCRLF
	.ASCII	''
	.BYTE	0
	.BYTE	0
	.BYTE	0
	.EVEN 
	BR	EXITC
	CMP	(SP)+,(SP)+
	BR	.-100
	BICB	#40,@#REL
EXITC:	RTS	PC

;		"^"
CHECKC:	CLRB	@#SAVKBB
	NOP
	NOP
	NOP
	NOP
	NOP
	BIC	#200,R2
	CMPB	#3,R2
	BNE	EXITC
	MOVB	R2,@#SAVKBB
	JSR	PC,TPCRLF
	.ASCII	'^C'
	.BYTE	0
	.EVEN
	JMP	RELOER
	.=7744
ENDPRG:	0
	.=7514
	CMP	R0,#140
	BCS	1$
	MOVB	#16,@ADRES
	BR	2$
1$:	MOVB	#17,@ADRES
2$:	INC	ADRES
3$:	MOVB	R0,@ADRES
	BEQ	4$
	INC	ADRES
	RTS	PC
4$:	MOV	#BUFER,ADRES
	MOV	#777,6$
	NOP
6$:	NOP
	RTS	PC
	.=10776
ADRES:	.WORD	BUFER
BUFER:
	.REPT	6400
	.BYTE	0
	.ENDR
	.=17400
VEK0:	INC	@#V0
	BR	.+6
VEK4:	INC	@#V4
	BR	.+6
VEK10:	INC	@#V10
	BR	.+6
VEK14:	INC	@#V14
	BR	.+6
VEK20:	INC	@#V20
	BR	.+6
VEK24:	INC	@#V24
	BR	.+6
VEK30:	INC	@#V30
	BR	.+6
VEK34:	INC	@#V34
	BR	.+6
VEK100:	INC	@#V100
	BR	.+6
VEK170:	INC	@#V170
	BR	SAVRON

	.=17500
SAVRON:	MOV	2(SP),@#MRS
	MOV	@SP,@#MPC
	MOV	SP,@#MSP
	MOV	R5,@#MR5
	MOV	R4,@#MR4
	MOV	R3,@#MR3
	MOV	R2,@#MR2
	MOV	R1,@#MR1
	MOV	R0,@#MR0 
1$:	WAIT	
	BR	1$
VEK174:	INC	@#V174
	BR	SAVRON
VEK250:	INC	@#V250
	BR	SAVRON
VEK274:	INC	@#V274
	BR	SAVRON
VEKXX:	INC	@#VXXX
	BR	SAVRON
	.=17722
V0:	.WORD	0
V4:	.WORD	0
V10:	.WORD	0
V14:	.WORD	0
V20:	.WORD	0
V24:	.WORD	0
V30:	.WORD	0
V34:	.WORD	0
V100:	.WORD	0
V170:	.WORD	0
V174:	.WORD	0
V250:	.WORD	0
V274:	.WORD	0
VXXX:	.WORD	0
	.=17756
MR0:	.WORD	0
MR1:	.WORD	0
MR2:	.WORD	0
MR3:	.WORD	0
MR4:	.WORD	0
MR5:	.WORD	0
MSP:	.WORD	0
MPC:	.WORD	0
MRS:	.WORD	0
	.END
